{"version":3,"sources":["../../src/lib/Queue.js"],"names":["jobs","CancellationMail","Queue","queues","init","forEach","key","handle","bee","Bee","redis","redisConfig","queue","job","createJob","save","on","handleFailure","process","err","console","log","name"],"mappings":";;;;;;;;;;;;;;AAAA;;;;AACA;;;;AAEA;;;;;;AAEA,IAAMA,OAAO,CAACC,0BAAD,CAAb;;IAEMC,K;AACJ,mBAAc;AAAA;;AACZ,SAAKC,MAAL,GAAc,EAAd;;AAEA,SAAKC,IAAL;AACD;;;;2BAEM;AAAA;;AACLJ,WAAKK,OAAL,CAAa,gBAAqB;AAAA,YAAlBC,GAAkB,QAAlBA,GAAkB;AAAA,YAAbC,MAAa,QAAbA,MAAa;;AAChC,cAAKJ,MAAL,CAAYG,GAAZ,IAAmB;AACjBE,eAAK,IAAIC,kBAAJ,CAAQH,GAAR,EAAa;AAChBI,mBAAOC;AADS,WAAb,CADY;AAIjBJ;AAJiB,SAAnB;AAMD,OAPD;AAQD;;;wBAEGK,K,EAAOC,G,EAAK;AACd,aAAO,KAAKV,MAAL,CAAYS,KAAZ,EAAmBJ,GAAnB,CAAuBM,SAAvB,CAAiCD,GAAjC,EAAsCE,IAAtC,EAAP;AACD;;;mCAEc;AAAA;;AACbf,WAAKK,OAAL,CAAa,eAAO;AAAA,8BACM,OAAKF,MAAL,CAAYU,IAAIP,GAAhB,CADN;AAAA,YACVE,GADU,mBACVA,GADU;AAAA,YACLD,MADK,mBACLA,MADK;;AAElBC,YAAIQ,EAAJ,CAAO,QAAP,EAAiB,OAAKC,aAAtB,EAAqCC,OAArC,CAA6CX,MAA7C;AACD,OAHD;AAID;;;kCAEaM,G,EAAKM,G,EAAK;AACtBC,cAAQC,GAAR,YAAqBR,IAAID,KAAJ,CAAUU,IAA/B,eAA+CH,GAA/C;AACD;;;;;kBAGY,IAAIjB,KAAJ,E","file":"Queue.js","sourcesContent":["import Bee from 'bee-queue';\nimport CancellationMail from '../app/jobs/CancellationMail';\n\nimport redisConfig from '../config/redis';\n\nconst jobs = [CancellationMail];\n\nclass Queue {\n  constructor() {\n    this.queues = {};\n\n    this.init();\n  }\n\n  init() {\n    jobs.forEach(({ key, handle }) => {\n      this.queues[key] = {\n        bee: new Bee(key, {\n          redis: redisConfig,\n        }),\n        handle,\n      };\n    });\n  }\n\n  add(queue, job) {\n    return this.queues[queue].bee.createJob(job).save();\n  }\n\n  processQueue() {\n    jobs.forEach(job => {\n      const { bee, handle } = this.queues[job.key];\n      bee.on('failed', this.handleFailure).process(handle);\n    });\n  }\n\n  handleFailure(job, err) {\n    console.log(`Queue ${job.queue.name}: FAILED`, err);\n  }\n}\n\nexport default new Queue();\n"]}