{"version":3,"sources":["../../../src/app/controllers/NotificationController.js"],"names":["NotificationController","req","res","User","findOne","where","id","userId","provider","checkProvider","status","json","error","Notification","find","user","sort","createdAt","limit","notifications","findByIdAndUpdate","params","read","new","notification"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA;;;;AACA;;;;;;IAEMA,sB;;;;;;;;2GACQC,G,EAAKC,G;;;;;;;uBAEaC,eAAKC,OAAL,CAAa;AACvCC,yBAAO;AACLC,wBAAIL,IAAIM,MADH;AAELC,8BAAU;AAFL;AADgC,iBAAb,C;;;AAAtBC,6B;;oBAODA,a;;;;;iDACIP,IAAIQ,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAAEC,OAAO,wBAAT,EAArB,C;;;;uBAGmBC,uBAAaC,IAAb,CAAkB;AAC5CC,wBAAMd,IAAIM;AADkC,iBAAlB,EAGzBS,IAHyB,CAGpB,EAAEC,WAAW,MAAb,EAHoB,EAIzBC,KAJyB,CAInB,EAJmB,C;;;AAAtBC,6B;iDAMCjB,IAAIS,IAAJ,CAASQ,aAAT,C;;;;;;;;;;;;;;;;;;;6GAGIlB,G,EAAKC,G;;;;;;;uBAEWW,uBAAaO,iBAAb,CACzBnB,IAAIoB,MAAJ,CAAWf,EADc,EAEzB,EAAEgB,MAAM,IAAR,EAFyB,EAGzB,EAAEC,KAAK,IAAP,EAHyB,C;;;AAArBC,4B;;oBAMDA,Y;;;;;kDACItB,IAAIQ,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAAEC,OAAO,2BAAT,EAArB,C;;;kDAGFV,IAAIS,IAAJ,CAASa,YAAT,C;;;;;;;;;;;;;;;;;;;;kBAKI,IAAIxB,sBAAJ,E","file":"NotificationController.js","sourcesContent":["import Notification from '../schemas/Notification';\nimport User from '../models/User';\n\nclass NotificationController {\n  async index(req, res) {\n\n    const checkProvider = await User.findOne({\n      where: {\n        id: req.userId,\n        provider: true\n      }\n    });\n\n    if (!checkProvider) {\n      return res.status(400).json({ error: \"You're not a provider!\" });\n    }\n\n    const notifications = await Notification.find({\n      user: req.userId\n    })\n      .sort({ createdAt: 'desc' })\n      .limit(20);\n\n    return res.json(notifications)\n  }\n\n  async update(req, res) {\n\n    const notification = await Notification.findByIdAndUpdate(\n      req.params.id,\n      { read: true },\n      { new: true }\n    );\n\n    if (!notification) {\n      return res.status(400).json({ error: 'Notification already read' });\n    }\n\n    return res.json(notification);\n  }\n\n}\n\nexport default new NotificationController();\n"]}